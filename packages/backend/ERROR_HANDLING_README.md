# üö® –°–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ —Ç–∏–ø–∞–º–∏ –æ—à–∏–±–æ–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞–º –∏ –¥–µ—Ç–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –æ—à–∏–±–æ–∫. –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –≥–∏–±–∫—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. ErrorHandlerService (`src/services/errorHandler.ts`)

–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∞–º–∏:

```typescript
interface AppError {
  type: ErrorType;                    // –¢–∏–ø –æ—à–∏–±–∫–∏
  code: ErrorCode;                    // –ö–æ–¥ –æ—à–∏–±–∫–∏
  message: string;                    // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
  details?: Record<string, any>;      // –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏
  timestamp: Date;                    // –í—Ä–µ–º—è –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è
  requestId?: string;                 // ID –∑–∞–ø—Ä–æ—Å–∞
  userId?: number;                    // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  operatorId?: number;                // ID –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
  path?: string;                      // –ü—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞
  method?: string;                    // HTTP –º–µ—Ç–æ–¥
  userAgent?: string;                 // User-Agent
  ip?: string;                        // IP –∞–¥—Ä–µ—Å
  stack?: string;                     // Stack trace
}
```

### 2. Error Handler Middleware (`src/middleware/errorHandler.ts`)

–ù–∞–±–æ—Ä middleware –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:

- **requestIdMiddleware** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- **validationErrorHandler** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **authErrorHandler** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **errorHandlerMiddleware** - –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
- **notFoundHandler** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ 404 –æ—à–∏–±–æ–∫
- **unhandledErrorHandler** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
- **performanceMonitor** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. Error Handler Routes (`src/routes/errorHandler.ts`)

API endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:

- `GET /error-handler/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫
- `GET /error-handler/critical` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- `GET /error-handler/config` - —Ç–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `PUT /error-handler/config` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `POST /error-handler/stats/reset` - —Å–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `GET /error-handler/top-errors` - —Ç–æ–ø –æ—à–∏–±–æ–∫ –ø–æ —á–∞—Å—Ç–æ—Ç–µ
- `GET /error-handler/by-type/:type` - –æ—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø—É
- `GET /error-handler/summary` - —Å–≤–æ–¥–∫–∞ –ø–æ –æ—à–∏–±–∫–∞–º
- `POST /error-handler/test` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- `GET /error-handler/export` - —ç–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```typescript
import { errorHandlerService, ErrorType, ErrorCode } from '../services/errorHandler';

// –°–æ–∑–¥–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
const validationError = errorHandlerService.createValidationError(
  'email',
  'invalid-email',
  '–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π email –∞–¥—Ä–µ—Å',
  req
);

// –°–æ–∑–¥–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
const authError = errorHandlerService.createAuthError(
  ErrorCode.INVALID_TOKEN,
  '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞',
  req
);

// –°–æ–∑–¥–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
const notFoundError = errorHandlerService.createNotFoundError(
  'chat',
  123,
  req
);
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ —Ä–æ—É—Ç–∞—Ö

```typescript
router.get('/chats/:id', requireOperator, asyncHandler(async (req, res) => {
  try {
    const chat = await chatService.getChat(Number(req.params.id));
    
    if (!chat) {
      const error = errorHandlerService.createNotFoundError(
        'chat',
        req.params.id,
        req
      );
      
      return res.status(404).json(
        errorHandlerService.formatErrorForClient(error)
      );
    }
    
    res.json(chat);
  } catch (error) {
    const appError = errorHandlerService.createDatabaseError(
      'get_chat',
      'chats',
      error,
      req
    );
    
    res.status(500).json(
      errorHandlerService.formatErrorForClient(appError)
    );
  }
}));
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```typescript
// Middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –æ—à–∏–±–∫–∏
app.use(errorHandlerMiddleware);

// –û–±—Ä–∞–±–æ—Ç–∫–∞ 404 –æ—à–∏–±–æ–∫
app.use(notFoundHandler);

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
app.use(unhandledErrorHandler);
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# Error Handling Configuration
MAX_ERROR_DETAILS_LENGTH=1000        # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–∫–∏
ERROR_SAMPLING_RATE=1.0              # –ß–∞—Å—Ç–æ—Ç–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ (0.0 - 1.0)
NODE_ENV=development                 # –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (development/production)
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
PUT /error-handler/config
{
  "enableDetailedErrors": true,
  "enableStackTraces": false,
  "errorSamplingRate": 0.8,
  "maxErrorDetailsLength": 2000
}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫

```bash
# –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET /error-handler/stats

# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
GET /error-handler/critical?limit=50

# –¢–æ–ø –æ—à–∏–±–æ–∫
GET /error-handler/top-errors?limit=20

# –°–≤–æ–¥–∫–∞
GET /error-handler/summary
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```json
{
  "success": true,
  "data": {
    "totalErrors": 1250,
    "criticalErrorsCount": 15,
    "errorCounts": {
      "VALIDATION_INVALID_INPUT": 450,
      "AUTHENTICATION_INVALID_TOKEN": 200,
      "DATABASE_CONNECTION_ERROR": 50,
      "FILE_UPLOAD_FAILED": 100
    },
    "topErrors": [
      {
        "code": "VALIDATION_INVALID_INPUT",
        "count": 450,
        "percentage": 36.0
      }
    ]
  }
}
```

## üõ°Ô∏è –¢–∏–ø—ã –æ—à–∏–±–æ–∫ –∏ –∫–æ–¥—ã

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫ (ErrorType)

```typescript
enum ErrorType {
  VALIDATION = 'VALIDATION',           // –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  AUTHENTICATION = 'AUTHENTICATION',   // –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  AUTHORIZATION = 'AUTHORIZATION',      // –û—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  NOT_FOUND = 'NOT_FOUND',             // –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
  CONFLICT = 'CONFLICT',               // –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –¥–∞–Ω–Ω—ã—Ö
  RATE_LIMIT = 'RATE_LIMIT',           // –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
  DATABASE = 'DATABASE',               // –û—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  EXTERNAL_SERVICE = 'EXTERNAL_SERVICE', // –û—à–∏–±–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  FILE_UPLOAD = 'FILE_UPLOAD',         // –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
  CACHE = 'CACHE',                     // –û—à–∏–±–∫–∏ –∫—ç—à–∞
  WEBSOCKET = 'WEBSOCKET',             // –û—à–∏–±–∫–∏ WebSocket
  INTERNAL = 'INTERNAL',               // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—à–∏–±–∫–∏
}
```

### –ö–æ–¥—ã –æ—à–∏–±–æ–∫ (ErrorCode)

```typescript
enum ErrorCode {
  // –í–∞–ª–∏–¥–∞—Ü–∏—è
  INVALID_INPUT = 'INVALID_INPUT',
  MISSING_REQUIRED_FIELD = 'MISSING_REQUIRED_FIELD',
  INVALID_FORMAT = 'INVALID_FORMAT',
  
  // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  INVALID_TOKEN = 'INVALID_TOKEN',
  TOKEN_EXPIRED = 'TOKEN_EXPIRED',
  INVALID_CREDENTIALS = 'INVALID_CREDENTIALS',
  
  // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
  INSUFFICIENT_PERMISSIONS = 'INSUFFICIENT_PERMISSIONS',
  ACCESS_DENIED = 'ACCESS_DENIED',
  
  // –ù–µ –Ω–∞–π–¥–µ–Ω–æ
  CHAT_NOT_FOUND = 'CHAT_NOT_FOUND',
  MESSAGE_NOT_FOUND = 'MESSAGE_NOT_FOUND',
  OPERATOR_NOT_FOUND = 'OPERATOR_NOT_FOUND',
  
  // –ò –¥—Ä—É–≥–∏–µ...
}
```

## üîç –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
const validationError = errorHandlerService.createValidationError(
  'email',
  userInput.email,
  'email_format',
  req
);
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```typescript
try {
  await database.query('SELECT * FROM users WHERE id = ?', [userId]);
} catch (error) {
  const dbError = errorHandlerService.createDatabaseError(
    'get_user',
    'users',
    error,
    req
  );
  throw dbError;
}
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```typescript
try {
  await telegramApi.sendMessage(chatId, message);
} catch (error) {
  const externalError = errorHandlerService.createExternalServiceError(
    'telegram',
    'send_message',
    error,
    req
  );
  throw externalError;
}
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏

```http
X-Request-ID: req_1234567890_abc123def
X-Response-Time: 150ms
X-Error-Type: VALIDATION
X-Error-Code: INVALID_INPUT
X-Query-Warnings: 2
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```typescript
// Middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–¥–ª–µ–Ω–Ω–µ–µ 1 —Å–µ–∫—É–Ω–¥—ã
if (duration > 1000) {
  logWarning('–ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å', {
    requestId: req.id,
    path: req.path,
    method: req.method,
    duration,
    statusCode: res.statusCode,
  });
}
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

```typescript
// –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–ø–∏—Å–æ–∫
if (this.config.criticalErrorCodes.includes(code)) {
  this.addCriticalError(error);
  
  // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  notifyAdminAboutCriticalError(error);
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
GET /error-handler/critical?limit=50

# –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
GET /error-handler/export?format=csv
```

## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Prometheus, Grafana)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Slack/Email
- [ ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö –æ—à–∏–±–æ–∫
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –æ—à–∏–±–æ–∫
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ APM (Application Performance Monitoring)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤—ã—Ö –æ—à–∏–±–æ–∫
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (ELK Stack)

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Error Handling Best Practices](https://expressjs.com/en/guide/error-handling.html)
- [Node.js Error Handling](https://nodejs.org/en/docs/guides/error-handling-and-logging/)
- [Express Error Handling](https://expressjs.com/en/advanced/best-practices-performance.html#handle-exceptions-properly)
- [Logging Best Practices](https://12factor.net/logs)

## üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫

```typescript
// –•–æ—Ä–æ—à–æ - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞
const error = errorHandlerService.createError(
  ErrorType.VALIDATION,
  ErrorCode.INVALID_INPUT,
  'Email –∞–¥—Ä–µ—Å –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç',
  { field: 'email', value: userInput.email, expectedFormat: 'email' },
  req
);

// –ü–ª–æ—Ö–æ - –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
throw new Error('Invalid email');
```

### 2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

```typescript
// Middleware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
logError('–û—à–∏–±–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', {
  requestId: req.id,
  error: appError,
  userAgent: req.get('User-Agent'),
  ip: req.ip,
});
```

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
function sanitizeRequestBody(body: any): any {
  const sensitiveFields = ['password', 'token', 'secret', 'key', 'auth'];
  
  for (const field of sensitiveFields) {
    if (body[field]) {
      body[field] = '[SENSITIVE_DATA]';
    }
  }
  
  return body;
}
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
res.on('finish', () => {
  const duration = Date.now() - startTime;
  
  if (duration > 1000) {
    logWarning('–ú–µ–¥–ª–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å', {
      requestId: req.id,
      path: req.path,
      duration,
    });
  }
});
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –æ—à–∏–±–∫–∞–º–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≥–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–º–æ–≥–∞—é—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º –±—ã—Å—Ç—Ä–æ –≤—ã—è–≤–ª—è—Ç—å –∏ —É—Å—Ç—Ä–∞–Ω—è—Ç—å –ø—Ä–æ–±–ª–µ–º—ã, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –≤—ã—Å–æ–∫—É—é –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ ID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø–∞–º –∏ –∫–æ–¥–∞–º
- –õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –û—á–∏—â–∞–µ—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤
- –£–≤–µ–¥–æ–º–ª—è–µ—Ç –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
