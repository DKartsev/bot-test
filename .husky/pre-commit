#!/usr/bin/env sh
cd -- "$(git rev-parse --show-toplevel)"

# Не выполнять хук в CI или если явно отключили
if [ -n "$CI" ] || [ "${HUSKY:-1}" = "0" ]; then
  echo "[husky] Skipping pre-commit (CI or HUSKY=0)."
  exit 0
fi

# Если нет npx — пропускаем
if ! command -v npx >/dev/null 2>&1; then
  echo "[husky] npx not found, skipping lint-staged."
  exit 0
fi

# Запускаем lint-staged; даже при ошибке НЕ блокируем коммит
if npx --no-install lint-staged; then
  echo "[husky] lint-staged finished."
else
  echo "[husky] lint-staged failed, but commit is allowed."
fi

exit 0
