#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç –ó–∞–ø—É—Å–∫ pre-commit –ø—Ä–æ–≤–µ—Ä–æ–∫..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç
echo "üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ staged —Ñ–∞–π–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
git diff --cached --name-only | while read file; do
  if [ -f "$file" ]; then
    echo "‚úÖ $file - OK"
  else
    echo "‚ùå $file - —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
  fi
done

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSON —Ñ–∞–π–ª–æ–≤
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ JSON —Ñ–∞–π–ª–æ–≤..."
git diff --cached --name-only | grep '\.json$' | while read file; do
  if [ -f "$file" ]; then
    if node -e "JSON.parse(require('fs').readFileSync('$file', 'utf8')); console.log('‚úÖ $file - JSON –≤–∞–ª–∏–¥–µ–Ω')" 2>/dev/null; then
      echo "‚úÖ $file - JSON –≤–∞–ª–∏–¥–µ–Ω"
    else
      echo "‚ùå $file - –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON!"
      exit 1
    fi
  fi
done

echo "‚úÖ –í—Å–µ pre-commit –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
echo "üöÄ –ú–æ–∂–µ—Ç–µ –¥–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç!"
